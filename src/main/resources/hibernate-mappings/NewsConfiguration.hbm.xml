<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping default-lazy="false" default-cascade="all-delete-orphan">
    
    <class name="org.jasig.portlet.newsreader.NewsConfiguration" table="NEWS_CONFIGURATION">
        
        <!-- BASE CLASS PROPERTIES -->
        <!-- We don't actually intend to use the base class on its own -->
        
        <!-- unique id -->
        <id name="id" type="long" unsaved-value="-1">
            <column name="NEWS_CONFIGURATION_ID" not-null="true"/>
            <generator class="native"/>
        </id>
        
        <!-- discriminator to determine whether this is an administratively 
            or user-defined news definition -->
        <discriminator column="NEWS_CONFIGURATION_TYPE" type="string"/>
        
        <!-- flag to determine whether this news should be displayed by default -->
        <property name="displayed" type="boolean">
            <column name="DISPLAYED"/>
        </property>
        
        <!-- flag to determine whether this feed is active -->
        <property name="active" type="boolean">
            <column name="ACTIVE"/>
        </property>
        
        <many-to-one 
            name="newsSet" 
            class="org.jasig.portlet.newsreader.NewsSet"
            column="SET_ID" 
            cascade="none" lazy="false"/> 
        
        
        <!-- SUBCLASSES -->
        
        <!-- user-defined newss and their configurations -->
        <subclass name="org.jasig.portlet.newsreader.PredefinedNewsConfiguration"
            discriminator-value="PD">
            
            <many-to-one 
                name="newsDefinition" 
                class="org.jasig.portlet.newsreader.PredefinedNewsDefinition"
                column="NEWS_ID" 
                cascade="none" lazy="false"/> 
            
            <!-- other user-specific preferences -->
            <map name="preferences" lazy="false" table="NEWS_PREFERENCE" cascade="all-delete-orphan"> 
                <key column="NEWS_CONFIGURATION_ID"/>
                <index column="NEWS_PREFERENCE_NAME" type="string"/>
                <element type="string" column="NEWS_PREFERENCE_VALUE" not-null="true"/> 
            </map> 
                        
        </subclass>
        
        
        <!-- admin-defined, system-wide newss -->
        <subclass name="org.jasig.portlet.newsreader.UserDefinedNewsConfiguration"
            discriminator-value="UD">
            
            <many-to-one 
                name="newsDefinition" 
                class="org.jasig.portlet.newsreader.UserDefinedNewsDefinition"
                column="NEWS_ID"
                cascade="all" lazy="false"/> 
            
        </subclass>
        
    </class>
    
</hibernate-mapping>
